
\RequirePackage{silence}
\WarningFilter{latex}{Writing or overwriting file}
\WarningFilter{minitoc(hints)}{W0024}

% Add fields to the bibliography datamodel
% Formatting and sorting is done in preamble in bib_setup.tex
\begin{filecontents*}[overwrite]{biblatex-dm.cfg}
\DeclareDatamodelFields[type=list, datatype=literal, label=true, nullok=true]{datavar}
\DeclareDatamodelEntryfields[dataset]{datavar}
\DeclareDatamodelFields[type=field, datatype=verbatim, nullok=true]{pypi}
\DeclareDatamodelEntryfields[software]{pypi}
\end{filecontents*}

%%% Document class
\documentclass[
12pt,
a4paper,
french,
openright,
twoside,
hyperfootnotes=false, % put here otherwise option clash
draft,
]
{memoir}

\usepackage{src/ch-thesis}

\AtBeginDocument{%
  \bookmark[named=FirstPage, level=section]{Page de garde}%
}

\begin{document}
\dominitoc

%%% Cover page
\include{tex/front_page}

%%% Front matter
\frontmatter
\include{tex/front_matter}

%%% Glossary
\setglswidth%
\printglossary[toctitle=Glossaire]

%%% TOC
\clearpage
{
  \setlength{\baselineskip}{1.03\onelineskip}
  \tableofcontents*
  % phantomsection already called by \tableofcontents
  \addcontentsline{toc}{section}{\contentsname}
}

\clearpage

%%% LOF
\listoffigures*
% phantomsection already called by \listoffigures
\addcontentsline{toc}{section}{\listfigurename}

\clearpage

%%% Mainmatter
\mainmatter%

\include{tex/intro}
\include{tex/méthodes}
\include{tex/res_chl}
\include{tex/res_phénologie}
\include{tex/conclusion}

%%% Appendices
\begin{appendices}
  \changeappendixmark%

\chapter[Article: \articleCceTitle][Article]{Article: \articleCceTitle}
\label[appendix]{ax:article-cce}
\chapter[Article: \articleReviewTitle][Article]{Article: \articleReviewTitle}
\label[appendix]{ax:article-review}

\renewcommand{\thesection}{\Alph{chapter}.\arabic{section}} % No chapter number in section
\chapterlof{Autres}
\label[appendix]{ax:autres}
\include{tex/annexes_autres}
\end{appendices}

%%% Bibliography
{
  \emergencystretch=1em
  \chapter*{\bibname}
  \mtcaddchapter[\bibname]
  \markboth{\bibname}{}
  \label{bib}
  \printbibliography[heading=none, filter=normal]

  \unsection{\bibdataTitle}
  \markright{\bibdataTitle}
  \label{bib:data}
  \printbibliography[heading=none, type=dataset]

  {
    \unsection{\bibsoftwareTitle}
    \markright{\bibsoftwareTitle}
    \label{bib:software}
    \raggedright%
    \printbibliography[heading=none, type=software]
  }
}

\backmatter%

\end{document}

